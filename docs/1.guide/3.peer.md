---
icon: mynaui:api
---

# Peer

> Peer object allows easily interacting with connected clients.

When a new client connects to the server, crossws creates a peer instance that allows getting information from clients and sending messages to them.

## Instance properties

### `peer.id`

Unique random [uuid v4](https://developer.mozilla.org/en-US/docs/Glossary/UUID) identifier for the message.

### `peer.request?`

Access to the upgrade [request](<(https://developer.mozilla.org/en-US/docs/Web/API/Request)>) info. You can use it to do authentication and access users headers and cookies.

> [!NOTE]
> This property is compatible with web [Request](https://developer.mozilla.org/en-US/docs/Web/API/Request) interface, However interface is emulated for Node.js and sometimes unavailable. Refer to the [compatibility table](#compatibility) for more info.

### `peer.remoteAddress?`

The IP address of the client.

> [!NOTE]
> Not all adapters provide this. Refer to the [compatibility table](#compatibility) for more info.

### `peer.webSocket`

Direct access to the [WebSocket](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket) instance (partial).

> [!NOTE]
> WebSocket available properties vary across runtimes. Refer to the [compatibility table](#compatibility) for more info.

### `peer.extensions`

Access to upgrade extensions using either native `webSocket.extensions` or `x` from `request.headers`

## Instance methods

### `peer.send(message, { compress? })`

Send a message to the connected client.

### `peer.subscribe(channel)`

Join a broadcast channel.

:read-more{to="/guide/pubsub"}

### `peer.unsubscribe(channel)`

Leave a broadcast channel.

:read-more{to="/guide/pubsub"}

### `peer.publish(channel, message)`

broadcast a message to the channel.

:read-more{to="/guide/pubsub"}

### `peer.close(code?, number?)`

Gracefully closes the connection.

Here is a list of close codes:

- `1000` means "normal closure" (default)
- `1009` means a message was too big and was rejected
- `1011` means the server encountered an error
- `1012` means the server is restarting
- `1013` means the server is too busy or the client is rate-limited
- `4000` through `4999` are reserved for applications (you can use it!)

To close the connection abruptly, use `peer.terminate()`.

### `peer.terminate()`

Abruptly close the connection.

To gracefully close the connection, use `peer.close()`.

## Compatibility

|                             | [Bun][bun] | [Cloudflare][cfw] | [Cloudflare (durable)][cfd] | [Deno][deno] | [Node (ws)][nodews] | [Node (μWebSockets)][nodeuws] | [SSE][sse] |
| --------------------------- | ---------- | ----------------- | --------------------------- | ------------ | ------------------- | ----------------------------- | ---------- |
| `send()`                    | ✓          | ✓                 | ✓                           | ✓            | ✓                   | ✓                             | ✓          |
| `publish()` / `subscribe()` | ✓          | ⨉                 | ✓ [^4]                      | ✓ [^4]       | ✓ [^4]              | ✓                             | ✓ [^4]     |
| `close()`                   | ✓          | ✓                 | ✓                           | ✓            | ✓                   | ✓                             | ✓          |
| `terminate()`               | ✓          | ✓ [^5]            | ✓                           | ✓            | ✓                   | ✓                             | ✓ [^5]     |
| `request`                   | ✓          | ✓                 | ✓ [^2]                      | ✓            | ✓ [^1]              | ✓ [^1]                        | ✓          |
| `webSocket.binaryType`      | ✓ [^3]     | ⨉                 | ⨉                           | ✓            | ✓ [^3]              | ⨉                             | ⨉          |
| `webSocket.bufferedAmount`  | ⨉          | ⨉                 | ⨉                           | ✓            | ✓                   | ✓                             | ⨉          |
| `webSocket.extensions`      | ⨉          | ✓                 | ✓                           | ✓            | ✓                   | ✓                             | ⨉          |
| `webSocket.protocol`        | ⨉          | ⨉                 | ⨉                           | ⨉            | ✓                   | ✓                             | ⨉          |
| `webSocket.readyState`      | ✓          | ✓                 | ✓                           | ✓            | ✓                   | ✓                             | ✓          |
| `webSocket.url`             | ⨉          | ✓                 | ✓                           | ✓            | ✓                   | ⨉                             | ⨉          |

[bun]: /adapters/bun
[cfw]: /adapters/cloudflare
[cfd]: /adapters/cloudflare#durable-objects
[deno]: /adapters/deno
[nodews]: /adapters/node
[nodeuws]: /adapters/node#uwebsockets
[sse]: adapters/sse

[^1]: using a proxy for [Request](https://developer.mozilla.org/en-US/docs/Web/API/Request) compatible interface (`url`, `headers` only) wrapping Node.js requests.

[^2]: `request` is not always available (only in `open` hook).

[^3]: these runtimes support non standard binary types including `nodebuffer` and `uint8array`.

[^4]: pubsub is not natively handled by runtime. crossws tracks peers and sends message to them.

[^5]: `close()` will be used for compatibility.
